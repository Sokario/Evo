/*
 * parser.c
 *
 *  Created on: 3 nov. 2017
 *      Author: LogOut
 */

#include "parser.h"

#define INFO_RUNNING_MASK 		0x20000000
#define INFO_POS_ANGLE_MASK 	0x25000000
#define INFO_POS_X_MASK 		0x26000000
#define INFO_POS_DISTANCE_MASK 	0x29000000
#define INFO_POS_Y_MASK 		0x2A000000
#define INFO_CAPT_TOR_MASK 		0x2C000000
#define INFO_CAPT_GP2_MASK 		0x2D000000
#define INFO_CAPT_COLOR_MASK 	0x2F000000

#define ACK_ERROR_UNKNOW_MASK 	0x30000000
#define ACK_ERROR_CMD_MASK 		0x31000000
#define ACK_ERROR_DATA_MASK 	0x32000000
#define ACK_RESEND_MASK 		0x34000000
#define ACK_OK_MASK 			0x38000000
#define ACK_END_MASK 			0x3C000000

u32 parser(u8 *cmd, u8 *result, XUartPs *uart)
{
	u32 status = -1;
	u32 cmd_value = 0, data_value = 0;

	cmd_value = strtol((char *)cmd, NULL, 16);
	data_value = cmd_value & DATA_MASK;
	cmd_value &= CMD_MASK;

	switch (cmd_value) {
		case QUIT_CMD :
			status = 0;
			strcpy(result, "QUIT0000");
			break;

		case CMD_STOP_MASK :
			status = 1;
			strcpy(result, "STOP0000");
			break;

		case CMD_SET_ANGLE_MASK :
			status = 2;
			strcpy(result, "SETA0000");
			break;

		case CMD_SET_DISTANCE_MASK :
			status = 3;
			strcpy(result, "SETD0000");
			break;

		case CMD_GET_ANGLE_MASK :
			status = 4;
			strcpy(result, "GETA0000");
			break;

		case CMD_GET_DISTANCE_MASK :
			status = 5;
			strcpy(result, "GETD0000");
			break;

		case CMD_RUN_ALL_MASK :
			status = 6;
			strcpy(result, "RUN00000");
			break;

		case CMD_RUN_ANGLE_MASK :
			status = 7;
			strcpy(result, "RUNA0000");
			break;

		case CMD_RUN_DISTANCE_MASK :
			status = 8;
			strcpy(result, "RUND0000");
			break;

		case INFO_RUNNING_MASK :
					status = 1;
					strcpy(result, "STOP0000");
					break;

				case INFO_POS_ANGLE_MASK :
					status = 2;
					strcpy(result, "SETA0000");
					break;

				case INFO_POS_X_MASK :
					status = 3;
					strcpy(result, "SETD0000");
					break;

				case INFO_POS_DISTANCE_MASK :
					status = 4;
					strcpy(result, "GETA0000");
					break;

				case INFO_POS_Y_MASK :
					status = 5;
					strcpy(result, "GETD0000");
					break;

				case INFO_CAPT_TOR_MASK :
					status = 6;
					strcpy(result, "RUN00000");
					break;

				case INFO_CAPT_GP2_MASK :
					status = 7;
					strcpy(result, "RUNA0000");
					break;

				case INFO_CAPT_COLOR_MASK :
					status = 8;
					strcpy(result, "RUND0000");
					break;

		default :
			status = -1;
			strcpy(result, "ER000000");
	}

	return status;
}
